# info[info$Subtype %in% c('MPN1', 'MPN2', 'MPN6', 'MPN8', 'H7N9', 'H9N2'), 'Subtype_new'] <-
#   info[info$Subtype %in% c('MPN1', 'MPN2', 'MPN6', 'MPN8', 'H7N9', 'H9N2'), 'Subtype']
retain <- (info$Subtype %>% table_DF() %>% arrange(desc(Freq)))[1:8, ] %>% select(x) %>% unlist
info[info$Subtype %in% retain, 'Subtype_new'] <-
info[info$Subtype %in% retain, 'Subtype']
info[, 'Subtype_new'] <- factor(info[, 'Subtype_new'], levels = c(retain, 'Other subtype'))
geno_rest <- geno %>% filter(Isolate_Id %in% info$Accesion_number)
geno_rest_top10 <- geno_rest$genotype %>% table_DF() %>% top_n(10, Freq) %>% pull(x)
geno_rest_top10 <- geno_rest$Genotype %>% table_DF() %>% top_n(10, Freq) %>% pull(x)
geno_rest_top10 <- geno_rest$Genotype %>% table_DF() %>% top_n(10, Freq) %>% pull(x)
geno_rest$genotype <- ifelse(geno_rest$Genotype %in% geno_rest_top10, yes = geno_rest$Genotype, no = NA)
info <- merge(info, geno_rest[, c("Isolate_Id", "genotype")], by.x = 'Accesion_number', by.y = "Isolate_Id", all.x = T)
rownames(info) <- info$Strain_number %>% as.character()
info <- info[rank, ] # %>% mutate(index=seq(1, nrow(info)))
info$Strain_number <- factor(info$Strain_number, levels =rev(rank))
# info$data_source <- str_remove_all(info$Accesion_number, pattern = '_[0-9]+')
# info[!(info$data_source %in% 'IRD'), 'data_source'] <- 'GISAID'
#change tree header to match the data
new_header <- info$Strain_number %>% as.character()
tree$tip.label <- new_header
#
phylo_raw <- ggtree(tree)
# class(phylo_raw)
# tree_list[[i]] <- phylo_raw
# phylo_raw <- tree_list[[i]]
clade <- info[, c(2, ncol(info))]
colnames(clade)[2] <- 'feature'
phylo <-
phylo_raw %<+% clade +
geom_tippoint(aes(color = feature), size = 2) +
scale_color_manual(values=c('other'='#848483', 'L1_L1_L1_H5_L1_N1_L1_L1'="#FF0000",
'L1_L1_L1_H5_L1_N1_L1_L2'="#FF6800",
'L1_L1_L1_H5_L1_N8_L1_L1'="#FFF000",
'L1_L1_L1_H5_L4_N1_L1_L3'="#05C802",
'L10_L1_L1_H5_L1_N8_L1_L2'="#02E1E5",
'L10_L2_L1_H5_L1_N1_L1_L1'="#0210E5",
'L10_L2_L1_H5_L1_N6_L1_L1'="#CC00D6",
'L10_L3_L1_H5_L3_N2_L1_L2'="#FF4DD1",
'L12_L1_L1_H5_L3_N1_L1_L2'="#6C3A02",
'L4_L2_L1_H5_L1_N6_L1_L1'="#1C7990"), na.value = "transparent") +
# scale_color_brewer(palette='Set3')+
labs(color='Assigned\nlineage')+# scale_colo(palette = 'Accent')+
theme(legend.position = "right", legend.text = element_text(size=20-8),
legend.title = element_text(size=22-8))  # Display the legend on the right
phylo
Heatmap_1 <- ggplot(info)+geom_tile(aes(x='', y=Strain_number,fill=continent, color=continent), linewidth=0.05)+
labs(x="Continent", fill='Continent', color='Continent') + ylab(NULL)+
scale_color_brewer(palette = 'Accent')+
scale_fill_brewer(palette = 'Accent')+
guides(fill = guide_legend(nrow = 1, direction = "vertical"))+
phylo_theme+theme(legend.position = "bottom")
Heatmap_2 <- ggplot(info)+geom_tile(aes(x='', y=Strain_number,fill=Clade_new, color=Clade_new), linewidth=0.05)+
labs(x="GISAID\nClade", fill="GISAID\nClade", color="GISAID\nClade") + ylab(NULL)+
# scale_color_manual(values = c('#4FC0E8','#7EEDA7','#5AA977','#EBF2F7', '#B63B3D'))+ #'#DF9E01','#DF3A01','#7B4322'
# scale_fill_manual(values = c('#4FC0E8','#7EEDA7','#5AA977','#EBF2F7', '#B63B3D'))+ #'#DF9E01','#DF3A01','#7B4322'
scale_color_manual(values = c("2.3.4.4"='#4FC0E8', "2.3.4.4b"='#7EEDA7','GsGD-others'='#5AA977','nonGsGD'='grey70', 'IRD_unlabel'= '#EBF2F7'))+ #'#DF9E01','#DF3A01','#7B4322'
scale_fill_manual(values = c("2.3.4.4"='#4FC0E8', "2.3.4.4b"='#7EEDA7','GsGD-others'='#5AA977','nonGsGD'='grey70', 'IRD_unlabel'= '#EBF2F7'))+ #'#DF9E01','#DF3A01','#7B4322'
guides(fill = guide_legend(nrow = 1, direction = "vertical"))+
phylo_theme+theme(legend.position = "bottom")
Heatmap_3 <- ggplot(info)+geom_tile(aes(x='', y=Strain_number,fill=Subtype_new, color=Subtype_new), linewidth=0.05)+
labs(x="Serotype", fill="Serotype", color="Serotype") + ylab(NULL)+
# scale_color_manual(values = c('MPN1'='#FFD97D','MPN2'='#FF8F54','MPN6'='#FF5356','MPN8'='#B63B3D','H7N9'='#71CE7B','H9N2'='#B9A4ED', 'Other subtype'='#EBF2F7'))+
# scale_fill_manual(values = c('MPN1'='#FFD97D','MPN2'='#FF8F54','MPN6'='#FF5356','MPN8'='#B63B3D','H7N9'='#71CE7B','H9N2'='#B9A4ED', 'Other subtype'='#EBF2F7'))+
scale_color_brewer(palette = 'Set2')+
scale_fill_brewer(palette = 'Set2')+
guides(fill = guide_legend(nrow = 1, direction = "vertical"))+
phylo_theme+theme(legend.position = "bottom")
Heatmap_6 <- ggplot(info)+geom_tile(aes(x="",y=Strain_number, fill=time_group, color=time_group), linewidth=0.05)+
labs(x="Year", fill="Year", color="Year") + ylab(NULL)+
scale_color_brewer(palette = 'Blues')+
scale_fill_brewer(palette = 'Blues')+
guides(fill = guide_legend(nrow = 1, direction = "vertical"))+
phylo_theme+theme(legend.position = "bottom")
# Load patchwork library
library(patchwork)
combined_plot <-
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'horizontal',
legend.box = 'vertical')
combined_plot
phylo
phylo <-
phylo_raw %<+% clade +
geom_tippoint(aes(color = feature), size = 2) +
scale_color_manual(values=c('other'='#848483', 'L1_L1_L1_H5_L1_N1_L1_L1'="#FF0000",
'L1_L1_L1_H5_L1_N1_L1_L2'="#FF6800",
'L1_L1_L1_H5_L1_N8_L1_L1'="#FFF000",
'L1_L1_L1_H5_L4_N1_L1_L3'="#05C802",
'L10_L1_L1_H5_L1_N8_L1_L2'="#02E1E5",
'L10_L2_L1_H5_L1_N1_L1_L1'="#0210E5",
'L10_L2_L1_H5_L1_N6_L1_L1'="#CC00D6",
'L10_L3_L1_H5_L3_N2_L1_L2'="#FF4DD1",
'L12_L1_L1_H5_L3_N1_L1_L2'="#6C3A02",
'L4_L2_L1_H5_L1_N6_L1_L1'="#1C7990"), na.value = "transparent") +
# scale_color_brewer(palette='Set3')+
labs(color='Assigned\nlineage')+# scale_colo(palette = 'Accent')+
theme(legend.position = "none", legend.text = element_text(size=20-8),
legend.title = element_text(size=22-8))  # Display the legend on the right
phylo
combined_plot <-
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'horizontal',
legend.box = 'vertical')
combined_plot
combined_plot <-
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'vertical',
legend.box = 'vertical')
combined_plot
combined_plot <-
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'horizontal',
legend.box = 'vertical')
combined_plot
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'horizontal',
legend.box = 'horizontal')
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'vertical',
legend.box = 'horizontal')
phylo
phylo <-
phylo_raw %<+% clade +
geom_tippoint(aes(color = feature), size = 2) +
scale_color_manual(values=c('other'='#848483', 'L1_L1_L1_H5_L1_N1_L1_L1'="#FF0000",
'L1_L1_L1_H5_L1_N1_L1_L2'="#FF6800",
'L1_L1_L1_H5_L1_N8_L1_L1'="#FFF000",
'L1_L1_L1_H5_L4_N1_L1_L3'="#05C802",
'L10_L1_L1_H5_L1_N8_L1_L2'="#02E1E5",
'L10_L2_L1_H5_L1_N1_L1_L1'="#0210E5",
'L10_L2_L1_H5_L1_N6_L1_L1'="#CC00D6",
'L10_L3_L1_H5_L3_N2_L1_L2'="#FF4DD1",
'L12_L1_L1_H5_L3_N1_L1_L2'="#6C3A02",
'L4_L2_L1_H5_L1_N6_L1_L1'="#1C7990"), na.value = "transparent") +
# scale_color_brewer(palette='Set3')+
labs(color='Assigned\nlineage')+# scale_colo(palette = 'Accent')+
theme(legend.position = "none")  # Display the legend on the right
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'vertical',
legend.box = 'horizontal')
phylo_raw %<+% clade +
geom_tippoint(aes(color = feature), size = 2) +
scale_color_manual(values=c('other'='#848483', 'L1_L1_L1_H5_L1_N1_L1_L1'="#FF0000",
'L1_L1_L1_H5_L1_N1_L1_L2'="#FF6800",
'L1_L1_L1_H5_L1_N8_L1_L1'="#FFF000",
'L1_L1_L1_H5_L4_N1_L1_L3'="#05C802",
'L10_L1_L1_H5_L1_N8_L1_L2'="#02E1E5",
'L10_L2_L1_H5_L1_N1_L1_L1'="#0210E5",
'L10_L2_L1_H5_L1_N6_L1_L1'="#CC00D6",
'L10_L3_L1_H5_L3_N2_L1_L2'="#FF4DD1",
'L12_L1_L1_H5_L3_N1_L1_L2'="#6C3A02",
'L4_L2_L1_H5_L1_N6_L1_L1'="#1C7990"), na.value = "transparent") +
# scale_color_brewer(palette='Set3')+
labs(color='Assigned\nlineage')+# scale_colo(palette = 'Accent')
guides(color = "none")
phylo <-
phylo_raw %<+% clade +
geom_tippoint(aes(color = feature), size = 2) +
scale_color_manual(values=c('other'='#848483', 'L1_L1_L1_H5_L1_N1_L1_L1'="#FF0000",
'L1_L1_L1_H5_L1_N1_L1_L2'="#FF6800",
'L1_L1_L1_H5_L1_N8_L1_L1'="#FFF000",
'L1_L1_L1_H5_L4_N1_L1_L3'="#05C802",
'L10_L1_L1_H5_L1_N8_L1_L2'="#02E1E5",
'L10_L2_L1_H5_L1_N1_L1_L1'="#0210E5",
'L10_L2_L1_H5_L1_N6_L1_L1'="#CC00D6",
'L10_L3_L1_H5_L3_N2_L1_L2'="#FF4DD1",
'L12_L1_L1_H5_L3_N1_L1_L2'="#6C3A02",
'L4_L2_L1_H5_L1_N6_L1_L1'="#1C7990"), na.value = "transparent") +
# scale_color_brewer(palette='Set3')+
labs(color='Assigned\nlineage')+# scale_colo(palette = 'Accent')
guides(color = "none")
(phylo + Heatmap_1 + Heatmap_3 + Heatmap_2 + Heatmap_6) +
plot_layout(guides = "collect", widths = c(0.6, 0.1, 0.1, 0.1, 0.1)) &
theme(legend.position = "bottom",
legend.direction = 'vertical',
legend.box = 'horizontal')
library(readr)
library(readxl)
library(ggplot2)
library(dplyr)
library(stringr)
library(data.table)
# setwd('/media/dyclab/新增磁碟區/Jeffery/HH_analysis')
H5HPAI_clear <- read.csv('/media/dyclab/新增磁碟區/Jeffery/HH_analysis/genotype_data_visualization1/data/H5HPAI_clear.csv')
is.na(H5HPAI_clear$Collection_Date) %>% table()
C_date <- H5HPAI_clear$Collection_Date
C_date1 <- strsplit(C_date, split = "-")
H5HPAI_clear$C_year <- 0
for (i in 1:nrow(H5HPAI_clear)) {
H5HPAI_clear[i,"C_year"] <- C_date1[[i]][[1]]
}
table(H5HPAI_clear$C_year)
class(H5HPAI_clear$C_year)
trytrysee <- table(H5HPAI_clear$Genotype) %>% as.data.frame()
trytrysee1 <- trytrysee[trytrysee$Freq >= 240,] # 前十最小 200
TOP10 <- trytrysee1$Var1 %>% as.character()
H5HPAI_clear$genotype_plot <- 0
for (i in 1:nrow(H5HPAI_clear)) {
if (H5HPAI_clear[i,"Genotype"] %in% TOP10) {
H5HPAI_clear[i,"genotype_plot"] <- H5HPAI_clear[i,"Genotype"]
}
if (!(H5HPAI_clear[i,"Genotype"] %in% TOP10)) {
H5HPAI_clear[i,"genotype_plot"] <- "other"
}
}
table(H5HPAI_clear$genotype_plot)
H5HPAI_clear$for_streamgraph <- 0
for (i in 1:nrow(H5HPAI_clear)) {
H5HPAI_clear[i,"for_streamgraph"] <- paste(H5HPAI_clear[i,"C_year"], H5HPAI_clear[i,"genotype_plot"], sep = "/")
}
streamgraphOwO <- table(H5HPAI_clear$for_streamgraph) %>% as.data.frame(stringsAsFactors = F)
Y_Geno <- strsplit(streamgraphOwO$Var1, split = "/")
streamgraphOwO$Year <- 0
streamgraphOwO$Genotype <- 0
for (i in seq_along(Y_Geno)) {
streamgraphOwO[i,"Year"] <- Y_Geno[[i]][[1]]
streamgraphOwO[i,"Genotype"] <- Y_Geno[[i]][[2]]
}
# ---------------------------------------------------------------------
# # Library create an interactive stream graph, suit for html
# library(streamgraph)
#
# # streamgraph
# test11 <- streamgraph(streamgraphOwO, key="Genotype", value="Freq", date="Year", height="300px", width="1000px") %>%
#   sg_legend(TRUE, "Genotype")
# test11
#
#
#
#
# ----------------------------------------------------------------------
# another method ggstream
library(ggplot2)
library(ggstream)
ggplot(streamgraphOwO, aes(x = Year, y = Freq, fill = Genotype, label = Genotype)) +
geom_stream(type = "proportional") +
geom_text(position = "stack", size = 3, color = "black") +
theme_minimal() +
labs(title = "Streamgraph with Labels", x = "Year", y = "Frequency")
streamgraphOwO_after_2000 <- streamgraphOwO[streamgraphOwO$Year>=2000, ]
streamgraphOwO_after_2000$Year <- streamgraphOwO_after_2000$Year %>% as.numeric()
# str(streamgraphOwO_after_2000)
streamgraphOwO_after_2000$Year <- as.Date(paste0(streamgraphOwO_after_2000$Year, "-01-01"))
streamgraph_plot <- ggplot(streamgraphOwO_after_2000, aes(x = Year, y = Freq, fill = Genotype)) +
geom_stream(color = "black")+
scale_fill_manual(
name = 'Genotype',
values=c('L1_L1_L1_H5_L1_N1_L1_L1'="#FF0000",
'L1_L1_L1_H5_L1_N1_L1_L2'="#FF6800",
'L1_L1_L1_H5_L1_N8_L1_L1'="#FFF000",
'L1_L1_L1_H5_L4_N1_L1_L3'="#05C802",
'L10_L1_L1_H5_L1_N8_L1_L2'="#02E1E5",
'L10_L2_L1_H5_L1_N1_L1_L1'="#0210E5",
'L10_L2_L1_H5_L1_N6_L1_L1'="#CC00D6",
'L10_L3_L1_H5_L3_N2_L1_L2'="#FF4DD1",
'L12_L1_L1_H5_L3_N1_L1_L2'="#6C3A02",
'L4_L2_L1_H5_L1_N6_L1_L1'="#1C7990",
'other'='#848483'))+
scale_x_date(date_breaks = "1 year", date_labels = "%Y")+
labs(y='Frequency')+
theme(
panel.background = element_rect(fill = "white", color = NA),  # 圖表區背景
plot.background = element_rect(fill = "white", color = NA),   # 整體圖表背景
axis.text.x = element_blank(),      # 隱藏 x 軸刻度標籤
axis.title.x = element_blank(),      # 隱藏 x 軸標題
axis.ticks.x = element_blank(),     # 隱藏 x 軸刻度線
text = element_text(family = 'Times New Roman')
)
# str(data)
# str(stacked_bar)
# write.table(stacked_bar, file = "output.txt", sep = ",", row.names = FALSE, col.names = TRUE, quote = TRUE)
# --------------------------------------------------------------------------------
# 單純用年份畫 Numbers of kinds of genotypes (H5 HPAI) 2000-2023
H5HPAI_clear$C_year <- as.Date(paste0(H5HPAI_clear$C_year, "-01-01"))
date_year_table <- table(streamgraphOwO_after_2000$Year) %>% as.data.frame()
date_year_table$Var1 <- date_year_table$Var1 %>% as.character()
date_year <- date_year_table$Var1
time_typenum_Y <- matrix(data = 0,nrow = length(date_year), ncol = 2) %>% as.data.frame()
colnames(time_typenum_Y) <- c('Time', 'type_num')
time_typenum_Y$Time <- date_year
i=1
for (i in 1:nrow(time_typenum_Y)) {
target_y <- time_typenum_Y[i, "Time"]
OwO <- H5HPAI_clear[H5HPAI_clear$C_year %in% target_y,]
OwO1 <- table(OwO$Genotype) %>% as.data.frame()
time_typenum_Y[i, "type_num"] <- nrow(OwO1)
}
time_typenum_Y$OwO <- 'A'
class(time_typenum_Y$Time)
time_typenum_Y$Time <- as.Date(time_typenum_Y$Time)
genotype_num_plot <- ggplot(time_typenum_Y, aes(x = Time, y = type_num, fill = OwO)) +
geom_stream(color = "black")+
scale_fill_manual(name = 'Numbers of kinds of genotypes',
values = c('A' = 'black'))+
labs(x='Year', y='Numbers of Genotype')+
theme(
legend.position = "none",
panel.background = element_rect(fill = "white", color = NA),  # 圖表區背景
plot.background = element_rect(fill = "white", color = NA),   # 整體圖表背景
text = element_text(family = 'Times New Roman')
)+
scale_x_date(date_breaks = "1 year", date_labels = "%Y")
# ------------------------------------------------------------------------
# combine genotype_num_plot and streamgraph_plot
library('aplot')
genotype_num_plot %>% insert_top(streamgraph_plot, height = 3.5)
library('cowplot')
fig1 <- plot_grid(streamgraph_plot, genotype_num_plot, nrow = 2,
align = "v", #align with x axis
rel_heights = c(3, 1)  #change the proportion between two plot
)
fig11 <- ggdraw(fig1) +
draw_label("a", x = 0.075, y = 0.95, size = 10, fontface = 'bold') +  # 標記 'a' 在 plot1
draw_label("b", x = 0.075, y = 0.25, size = 10, fontface = 'bold')  # 標記 'b' 在 plot2
# WOAH data
WOAH <- read.csv('/media/dyclab/新增磁碟區/Jeffery/HH_analysis/genotype_data_visualization1/原料/Quantitative data 2025-02-27.csv')
summary(WOAH)
Dz_list <- table(WOAH$Disease) %>% as.data.frame()
Dz_list[77, 'Var1']
HPAI_poultry <- WOAH[WOAH$Disease %in% 'High pathogenicity avian influenza viruses (poultry) (Inf. with)', ]
Dz_list[89, 'Var1']
HPAI_non_poultry <- WOAH[WOAH$Disease %in% 'Influenza A viruses of high pathogenicity (Inf. with) (non-poultry including wild birds) (2017-)', ]
table(HPAI_poultry$Animal.Category)
table(HPAI_poultry$Species)
table(HPAI_poultry$Vaccinated)
table(HPAI_poultry$Serotype.Subtype.Genotype)
table(HPAI_poultry$Semester)
#poultry also have wile, non-poultry also have domestic
table(HPAI_non_poultry$Animal.Category)
table(HPAI_non_poultry$Serotype.Subtype.Genotype)
# per year, H5 HPAI, 2000-2023/06, cases, bird host(wild vs domestic) vs mammal
HPAI_aiv <- rbind(HPAI_poultry, HPAI_non_poultry)
table(HPAI_aiv$Year)
class(HPAI_aiv$Year)
HPAI_aiv_before_2022 <- HPAI_aiv[HPAI_aiv$Year < 2023,]
HPAI_aiv_2023 <- HPAI_aiv[HPAI_aiv$Year == 2023,]
table(HPAI_aiv_2023$Semester)
HPAI_aiv_202306 <- HPAI_aiv_2023[HPAI_aiv_2023$Semester %in% 'Jan-Jun 2023', ]
HPAI_aiv_before_202306 <- rbind(HPAI_aiv_before_2022, HPAI_aiv_202306)
# is.na(HPAI_aiv_before_202306$Species) %>% table()
# test <- HPAI_aiv_before_202306[HPAI_aiv_before_202306$Species %in% '', ]
# table(test$Animal.Category)
# table(test$Cases)
# -   14   82   92
# 5989    2    1    1
# exclude Species label in ''
HPAI_aiv_before_202306_spE <- HPAI_aiv_before_202306[!(HPAI_aiv_before_202306$Species %in% ''), ]
table(HPAI_aiv_before_202306_spE$Serotype.Subtype.Genotype)
H5_HPAI_aiv_before_202306_spE <- HPAI_aiv_before_202306_spE[grep(pattern = 'H5', x = HPAI_aiv_before_202306_spE$Serotype.Subtype.Genotype), ]
table(H5_HPAI_aiv_before_202306_spE$Serotype.Subtype.Genotype)
table(H5_HPAI_aiv_before_202306_spE$Animal.Category)
table(H5_HPAI_aiv_before_202306_spE$Species)
# non bird host : Bees, Bovine, Cats, Cattle, Dogs, Striped Skunk, Tiger
H5_HPAI_aiv_before_202306_spE$Species_OwO <- NA
Bees <- H5_HPAI_aiv_before_202306_spE[H5_HPAI_aiv_before_202306_spE$Species %in% 'Bees',]
# no cases '-'
H5_HPAI_aiv_before_202306_spE$Cases %>% table()
H5_HPAI_aiv_before_202306_spE_case <- H5_HPAI_aiv_before_202306_spE[ !(H5_HPAI_aiv_before_202306_spE$Cases %in% '-'), ]
mammal <- c('Bovine', 'Cats', 'Cattle', 'Dogs', 'Striped Skunk', 'Tiger')
H5_HPAI_aiv_before_202306_spE_case[!(H5_HPAI_aiv_before_202306_spE_case$Species %in% mammal), 'Species_OwO'] <- 'Bird'
H5_HPAI_aiv_before_202306_spE_case[H5_HPAI_aiv_before_202306_spE_case$Species %in% mammal, 'Species_OwO'] <- 'Mammal'
Mammal_data <- H5_HPAI_aiv_before_202306_spE_case[H5_HPAI_aiv_before_202306_spE_case$Species_OwO %in% 'Mammal',]
# exclude mammal data, because is to small in amount
H5_HPAI_aiv_before_202306_spE_case_bird <- H5_HPAI_aiv_before_202306_spE_case[H5_HPAI_aiv_before_202306_spE_case$Species_OwO %in% 'Bird', ]
table(H5_HPAI_aiv_before_202306_spE_case_bird$Animal.Category)
# is.na(H5_HPAI_aiv_before_202306_spE_case_bird$Cases) %>% table()
H5_HPAI_aiv_before_202306_spE_case_bird$Cases <- H5_HPAI_aiv_before_202306_spE_case_bird$Cases %>% as.numeric()
# # wild and domestic maybe need to draw separately
# WOAH_plot_table <- matrix(0, nrow = length(2005:2023)*2, ncol = 3) %>% as.data.frame()
# colnames(WOAH_plot_table) <- c('Year', 'Type', 'Cases')
#
# WOAH_plot_table$Year <- 2005:2023
# WOAH_plot_table[1:length(2005:2023), 'Type'] <- 'Domestic'
# WOAH_plot_table[(length(2005:2023)+1):nrow(WOAH_plot_table), 'Type'] <- 'Wild'
#
#
# i=1
# for (i in 1:nrow(WOAH_plot_table)) {
#   year_OwO <- WOAH_plot_table[i, 'Year']
#   type_OwO <- WOAH_plot_table[i, 'Type']
#   data_OwO <- H5_HPAI_aiv_before_202306_spE_case_bird
#   sub_data_OwO <- data_OwO[(data_OwO$Year %in% year_OwO)&(data_OwO$Animal.Category %in% type_OwO),]
#   WOAH_plot_table[i, 'Cases'] <- sum(sub_data_OwO$Cases)
# }
#
#
#
# ggplot(WOAH_plot_table, aes(x = Year, y = Cases, fill = Type)) +
#   geom_stream(color = "black")
#
table(H5_HPAI_aiv_before_202306_spE_case_bird$World.region)
table(H5_HPAI_aiv_before_202306_spE_case_bird$Species)
table(H5_HPAI_aiv_before_202306_spE_case_bird$Animal.Category)
FAO_AIV <- read.csv('/media/dyclab/新增磁碟區/Jeffery/data/FAO/epidemiology-raw-data_202410081208.csv')
#some data unclean (move on cell right)
# FAO_AIV_QAQ <- FAO_AIV[is.na(FAO_AIV$Latitude), ]
# FAO_AIV_OwO <- FAO_AIV[!(is.na(FAO_AIV$Latitude)), ]
#
# FAO_AIV_QAQ1 <- FAO_AIV_QAQ
# FAO_AIV_QAQ1[, 9:17] <- FAO_AIV_QAQ[, 10:18]
# FAO_AIV_QAQ1$Human.deaths <- NA
#
# FAO_AIV <- rbind(FAO_AIV_OwO, FAO_AIV_QAQ1)
#choose data which have observe .m.y
is.na(FAO_AIV$Observation.date..dd.mm.yyyy.) %>% table()
FAO_AIV1 <- FAO_AIV[!(is.na(FAO_AIV$Observation.date..dd.mm.yyyy.)), ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status == 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status == 'NICD', ]
clean_of_NICD <- unclean
clean_of_NICD[, 12:15] <- unclean[, 13:16]
NICD_correct <- rbind(non_NICD, clean_of_NICD)
unclean$OB_year <- NA
FAO_AIV <- read.csv('/media/dyclab/新增磁碟區/Jeffery/data/FAO/epidemiology-raw-data_202410081208.csv')
#choose data which have observe .m.y
is.na(FAO_AIV$Observation.date..dd.mm.yyyy.) %>% table()
FAO_AIV1 <- FAO_AIV[!(is.na(FAO_AIV$Observation.date..dd.mm.yyyy.)), ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status == 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status == 'NICD', ]
clean_of_NICD <- unclean
clean_of_NICD[, 12:15] <- unclean[, 13:16]
NICD_correct <- rbind(non_NICD, clean_of_NICD)
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status == 'NICD', ]
#create ob m.y. colume
NICD_correct <- FAO_AIV1
OwO <- str_split(NICD_correct$Observation.date..dd.mm.yyyy., pattern = '/')
NICD_correct$OB_year <- NA
NICD_correct$OB_month <- NA
is.na(NICD_correct$Latitude) %>% table()
unclean <- NICD_correct[1, ]
View(unclean)
for (i in seq_along(OwO)) {
error_test_OwO <- try(OwO[[i]][[3]])
if (inherits(error_test_OwO, 'try-error')) {
unclean <- rbind(unclean, NICD_correct[i,])
} else{
NICD_correct[i, 'OB_year'] <- OwO[[i]][[3]]
NICD_correct[i, 'OB_month'] <- OwO[[i]][[2]]
}
}
View(unclean)
View(NICD_correct)
FAO_AIV <- read.csv('/media/dyclab/新增磁碟區/Jeffery/data/FAO/epidemiology-raw-data_202410081208.csv')
#some data unclean (move on cell right)
FAO_AIV_QAQ <- FAO_AIV[is.na(FAO_AIV$Latitude), ]
FAO_AIV_OwO <- FAO_AIV[!(is.na(FAO_AIV$Latitude)), ]
#choose data which have observe .m.y
is.na(FAO_AIV$Observation.date..dd.mm.yyyy.) %>% table()
FAO_AIV1 <- FAO_AIV[!(is.na(FAO_AIV$Observation.date..dd.mm.yyyy.)), ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status == 'NICD'), ]
View(FAO_AIV)
View(FAO_AIV1)
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status == 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status == 'NICD', ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status %in% 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status %in% 'NICD', ]
View(unclean)
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status %in% 'NICD'), ]
FAO_AIV1$Diagnosis.status %in% 'NICD' %>% table()
FAO_AIV <- read.csv('/media/dyclab/新增磁碟區/Jeffery/data/FAO/epidemiology-raw-data_202410081208.csv')
#choose data which have observe .m.y
is.na(FAO_AIV$Observation.date..dd.mm.yyyy.) %>% table()
FAO_AIV1 <- FAO_AIV[!(is.na(FAO_AIV$Observation.date..dd.mm.yyyy.)), ]
library(readr)
library(readxl)
library(ggplot2)
library(dplyr)
library(stringr)
library(data.table)
#choose data which have observe .m.y
is.na(FAO_AIV$Observation.date..dd.mm.yyyy.) %>% table()
FAO_AIV1 <- FAO_AIV[!(is.na(FAO_AIV$Observation.date..dd.mm.yyyy.)), ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status %in% 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status %in% 'NICD', ]
FAO_AIV1[FAO_AIV1$Diagnosis.status %in% 'NICD', ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status %in% 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status %in% 'NICD', ]
FAO_AIV <- read.csv('/media/dyclab/新增磁碟區/Jeffery/data/FAO/epidemiology-raw-data_202410081208.csv')
#choose data which have observe .m.y
is.na(FAO_AIV$Observation.date..dd.mm.yyyy.) %>% table()
FAO_AIV1 <- FAO_AIV[!(is.na(FAO_AIV$Observation.date..dd.mm.yyyy.)), ]
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status %in% 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status %in% 'NICD', ]
View(FAO_AIV1)
class(FAO_AIV)
class(FAO_AIV1)
View(FAO_AIV1)
# Pick up NICD data and fix it
non_NICD <- FAO_AIV1[!(FAO_AIV1$Diagnosis.status == 'NICD'), ]
unclean <- FAO_AIV1[FAO_AIV1$Diagnosis.status == 'NICD', ]
