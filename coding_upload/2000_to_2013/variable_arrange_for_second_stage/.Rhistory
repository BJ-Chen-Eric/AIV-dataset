FAO <- fread("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv") %>% as.data.frame()
# -----------------------------------
# 20240405
# outbreak farm
# H5 HPAI / Domestic / Confirm cases / 2014-2023
FAO <- fread("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv", fill = T, comment.char=.) %>% as.data.frame()
# -----------------------------------
# 20240405
# outbreak farm
# H5 HPAI / Domestic / Confirm cases / 2014-2023
FAO <- fread("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv", fill = T) %>% as.data.frame()
FAO <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv")
View(FAO)
colnames(FAO) <- FAO[10,]
FAO <- FAO[11:nrow(FAO),]
OwO <- strsplit(x = FAO$Observation.date..dd.mm.yyyy., split = "/")
FAO$O_Y <- 0
FAO$O_M <- 0
FAO$O_D <- 0
for (i in seq_along(OwO)) {
FAO[i,"O_D"] <- OwO[i][[1]][[1]] %>% as.numeric()
FAO[i,"O_M"] <- OwO[i][[1]][[2]] %>% as.numeric()
FAO[i,"O_Y"] <- OwO[i][[1]][[3]] %>% as.numeric()
}
OwO[i]
OwO[i]
OwO[i][[1]][[1]]
OwO[i][[1]]
OwO[i][[1]] == character(0)
OwO[i][[1]] == NULL
is.na(OwO[i][[1]])
View(OwO)
colnames(FAO)
for (i in seq_along(OwO)) {
test_id <- FAO[i,"Event.ID"]
FAO[i,"O_D"] <- OwO[i][[1]][[1]] %>% as.numeric()
FAO[i,"O_M"] <- OwO[i][[1]][[2]] %>% as.numeric()
FAO[i,"O_Y"] <- OwO[i][[1]][[3]] %>% as.numeric()
}
OwO[i]
OwO[i] == NA
OwO[i] == NULL
1 == NA
1 %in% NA
OwO[i] %in% NA
class(OwO[i])
OwO[i][[1]]
OwO[i][[1]] %in% na
OwO[i][[1]] %in% NA
is.na(OwO[i][[1]])
is.na(OwO[i][[1]][[1]])
OwO1 <- unlist(OwO[i])
# -----------------------------------
# 20240405
# outbreak farm
# H5 HPAI / Domestic / Confirm cases / 2014-2023
FAO <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv")
colnames(FAO) <- FAO[10,]
FAO <- FAO[11:nrow(FAO),]
FAO1 <- FAO[!(FAO$Observation.date..dd.mm.yyyy. %in% ""),]
OwO <- strsplit(x = FAO1$Observation.date..dd.mm.yyyy., split = "/")
FAO1$O_Y <- 0
FAO1$O_M <- 0
FAO1$O_D <- 0
for (i in seq_along(OwO)) {
FAO1[i,"O_D"] <- OwO[i][[1]][[1]] %>% as.numeric()
FAO1[i,"O_M"] <- OwO[i][[1]][[2]] %>% as.numeric()
FAO1[i,"O_Y"] <- OwO[i][[1]][[3]] %>% as.numeric()
}
View(FAO1)
FAO <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv")
colnames(FAO) <- FAO[10,]
FAO <- FAO[11:nrow(FAO),]
unique(FAO$Animal.type)
D_bug <- FAO[FAO$Animal.type %in% "Confirmed"]
D_bug <- FAO[FAO$Animal.type %in% "Confirmed",]
View(D_bug)
# -----------------------------------
# 20240405
# outbreak farm
# H5 HPAI / Domestic / Confirm cases / 2014-2023
FAO <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404050724.csv")
colnames(FAO) <- FAO[10,]
FAO <- FAO[11:nrow(FAO),]
unique(FAO$Animal.type)
# -----------------------------------
# 20240405
# outbreak farm
# H5 HPAI / Domestic / Confirm cases / 2014-2023
FAO <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404051255.csv")
colnames(FAO) <- FAO[10,]
FAO <- FAO[11:nrow(FAO),]
unique(FAO$Animal.type)
D_bug <- FAO[FAO$Animal.type %in% "Confirmed",]
unique(FAO$Diagnosis.status)
D_bug1 <- FAO[FAO$Diagnosis.status %in% "NICD",]
unique(FAO$Diagnosis.status)
D_bug1 <- FAO[FAO$Diagnosis.status %in% " NICD",]
View(D_bug1)
View(D_bug)
View(D_bug1)
View(D_bug)
for (i in 13:18) {
D_bug[,(i-1)] <- D_bug[,i]
}
colnames(D_bug)
for (i in 1:4) {
ID <- D_bug[i,"Event.ID"]
FAO[FAO$Event.ID %in% ID,] <- D_bug[i,]
}
unique(FAO$Animal.type)
unique(FAO$Diagnosis.status)
FAO1 <- FAO[!(FAO$Observation.date..dd.mm.yyyy. %in% ""),]
OwO <- strsplit(x = FAO1$Observation.date..dd.mm.yyyy., split = "/")
FAO1$O_Y <- 0
FAO1$O_M <- 0
FAO1$O_D <- 0
for (i in seq_along(OwO)) {
FAO1[i,"O_D"] <- OwO[i][[1]][[1]] %>% as.numeric()
FAO1[i,"O_M"] <- OwO[i][[1]][[2]] %>% as.numeric()
FAO1[i,"O_Y"] <- OwO[i][[1]][[3]] %>% as.numeric()
}
View(FAO1)
FAO1 <- FAO1[-c(52527,52528)]
FAO1 <- FAO1[-c(52527,52528),]
target_sero <- unique(FAO1$Serotype)
target_sero1 <- target_sero[intersect(grep(x = target_sero, pattern = "^H5"),grep(x = target_sero, pattern = "HPAI$"))]
H5_HPAI <- FAO1[FAO1$Serotype %in% target_sero1,]
H5_HPAI_Domestic <- H5_HPAI[H5_HPAI$Animal.type %in% "Domestic",]
table(H5_HPAI_Domestic$Species)
H5_HPAI_Domestic_Confirm <- H5_HPAI_Domestic[H5_HPAI_Domestic$Diagnosis.status %in% 'Confirmed',]
H5_HPAI_Domestic_Confirm_1423 <- H5_HPAI_Domestic_Confirm[(H5_HPAI_Domestic_Confirm$O_Y >= 2014)&(H5_HPAI_Domestic_Confirm$O_Y <= 2023),]
# table(H5_HPAI_Domestic$Species)
table(FAO1$Species)
View(H5_HPAI_Domestic_Confirm_1423)
View(H5_HPAI_Domestic_Confirm_1423)
write.csv(H5_HPAI_Domestic_Confirm_1423, file = "outbreak_farm/H5_HPAI_Domestic_Confirm_1423.csv", row.names = F)
complete_grid_data <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/LISA/complete_grid_data_HH_2014_to_2023.csv")
View(complete_grid_data)
H5_HPAI_Domestic_ID <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/H5_HPAI_Domestic_ID.csv")
View(H5_HPAI_Domestic_ID)
View(complete_grid_data)
ID_data <- complete_grid_data[c(1,2),]
View(ID_data)
ID_data <- complete_grid_data[,c(1,2)]
colnames(ID_data)[2] <- "H5_HPAI_Domestic"
ID_data[,"H5_HPAI_Domestic"] <- 0
ID_data[ID_data$Id %in% H5_HPAI_Domestic_ID$Id,"H5_HPAI_Domestic"] <- 1
write.csv(ID_data, file = "整理好的/H5_HPAI_Domestic.csv", row.names = F)
library(readr)
library(readxl)
library(ggplot2)
library(dplyr)
library(stringr)
library(dendextend)
library(car) #vif()
library(formattable)
library(pROC)
# 20240405
complete_grid_data <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/complete_grid_data_HH_2014_to_2023.csv")
View(complete_grid_data)
EU_grid <- complete_grid_data[complete_grid_data$Europe == 1,]
EU_grid1 <- EU_grid[,c("Id","case_YN")]
View(EU_grid1)
View(EU_grid)
clog_EU_result_out <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/matched_pairs/result/clog_EU_result_out.csv")
MH_EU_result_out <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/matched_pairs/result/MH_EU_result_out.csv")
clog_EU_more_than_10 <- clog_EU_result_out[clog_EU_result_out$Nsp.in.Npa. > 10,]
MH_EU_more_than_10 <- MH_EU_result_out[MH_EU_result_out$Nsp.in.Npa. > 10,]
target_EU <- union(clog_EU_more_than_10$X, MH_EU_more_than_10$X)
bird_YN_europe <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/鳥種母資料/bird_YN_europe.csv")
bird_25_YN <- bird_YN_europe[,c(1,which(colnames(bird_YN_europe) %in% target_EU))]
View(bird_25_YN)
shannon_EU_25 <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/shannon_EU_25.csv")
H5_HPAI_Domestic <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/H5_HPAI_Domestic.csv")
landcovertype_threshold_10_percent <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/landcovertype_threshold_10_percent.csv")
livestock <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/livestock.csv")
AAA <- merge(x = EU_grid1, y = bird_25_YN, by = "Id", all.x = TRUE)
BBB <- merge(x = AAA, y = shannon_EU_25, by = "Id", all.x = TRUE)
CCC <- merge(x = BBB, y = H5_HPAI_Domestic, by = "Id", all.x = TRUE)
DDD <- merge(x = CCC, y = landcovertype_threshold_10_percent, by = "Id", all.x = TRUE)
EEE <- merge(x = DDD, y = livestock[,c(1,5,6,7)], by = "Id", all.x = TRUE)
View(EEE)
GGG <- EEE[,-1]
# Class_95 全部都是0 剔除
HHH <- GGG[,-which(colnames(GGG) %in% "Class_95")]
# 參數對照表
varname <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/參數對照.csv")
# 單變項 --------------------------------------------------------
all_variable <- colnames(HHH)[-1]
simple_result <- data.frame(matrix(0, length(all_variable), 3))
colnames(simple_result) <- c("Variable", "coefficient", "pvalue")
simple_result[,"Variable"] <- all_variable
for (i in all_variable) {
y <- "case_YN"
x <- i
simple_form <- paste(y, " ~ ", x, sep = "") %>% as.formula()
simple_log_model <- glm(simple_form, data = HHH, family = 'binomial')
simple_result[simple_result$Variable %in% i,"coefficient"] <- summary(simple_log_model)$coefficients[i,"Estimate"]
simple_result[simple_result$Variable %in% i,"pvalue"] <- summary(simple_log_model)$coefficients[i,"Pr(>|z|)"]
}
for (i in varname$original) {
simple_result[simple_result$Variable %in% i,"Variable"] <- varname[varname$original %in% i,"full_name"]
}
View(simple_result)
simple_result1 <- simple_result[1:10,]
simple_result2 <- simple_result[11:20,]
simple_result3 <- simple_result[21:30,]
simple_result4 <- simple_result[31:40,]
formattable(simple_result1, align = c("l", rep("c", ncol(simple_result1)-1)),
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
View(simple_result1)
write.csv(simple_result, file = "D://梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/歐洲/result/simple_result.csv")
write.csv(simple_result, file = "D://梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/歐洲/result/simple_result.csv", row.names = F)
simple_result2 <- simple_result[11:20,]
formattable(simple_result2, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
formattable(simple_result3, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
formattable(simple_result4, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
formattable(simple_result4, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
formattable(simple_result4, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
library(readr)
library(readxl)
library(data.table)
library(ggplot2)
library(dplyr)
library(stringr)
library(viridis)
library(aplot)
library(cowplot)
library(ggplotify)
library(vegan)
# 20240410
# outbreak farm
FAO <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/overview-raw-data_202404051255.csv")
View(FAO)
colnames(FAO) <- FAO[10,]
FAO <- FAO[11:nrow(FAO),]
unique(FAO$Animal.type)
unique(FAO$Diagnosis.status)
D_bug <- FAO[FAO$Animal.type %in% "Confirmed",]
D_bug1 <- FAO[FAO$Diagnosis.status %in% " NICD",]
for (i in 13:18) {
D_bug[,(i-1)] <- D_bug[,i]
}
for (i in 1:4) {
ID <- D_bug[i,"Event.ID"]
FAO[FAO$Event.ID %in% ID,] <- D_bug[i,]
}
FAO1 <- FAO[!(FAO$Observation.date..dd.mm.yyyy. %in% ""),]
OwO <- strsplit(x = FAO1$Observation.date..dd.mm.yyyy., split = "/")
FAO1$O_Y <- 0
FAO1$O_M <- 0
FAO1$O_D <- 0
for (i in seq_along(OwO)) {
FAO1[i,"O_D"] <- OwO[i][[1]][[1]] %>% as.numeric()
FAO1[i,"O_M"] <- OwO[i][[1]][[2]] %>% as.numeric()
FAO1[i,"O_Y"] <- OwO[i][[1]][[3]] %>% as.numeric()
}
FAO1 <- FAO1[-c(52527,52528),]
target_sero <- unique(FAO1$Serotype)
target_sero1 <- target_sero[intersect(grep(x = target_sero, pattern = "^H5"),grep(x = target_sero, pattern = "HPAI$"))]
H5_HPAI <- FAO1[FAO1$Serotype %in% target_sero1,]
H5_HPAI_Domestic <- H5_HPAI[H5_HPAI$Animal.type %in% "Domestic",]
H5_HPAI_Domestic_Confirm <- H5_HPAI_Domestic[H5_HPAI_Domestic$Diagnosis.status %in% 'Confirmed',]
H5_HPAI_Domestic_Confirm_1423 <- H5_HPAI_Domestic_Confirm[(H5_HPAI_Domestic_Confirm$O_Y >= 2014)&(H5_HPAI_Domestic_Confirm$O_Y <= 2023),]
Species <- table(H5_HPAI_Domestic_Confirm_1423$Species) %>% as.data.frame()
View(Species)
unique(FAO1$Animal.type)
remove_Species <- c("Canine", "Cats", "Dogs", "Ferret", "Swine")
H5_HPAI_farm_Confirm_1423 <- H5_HPAI_Domestic_Confirm_1423[!(H5_HPAI_Domestic_Confirm_1423$Species %in% remove_Species),]
table(H5_HPAI_farm_Confirm_1423$Species)
write.csv(H5_HPAI_farm_Confirm_1423, file = "outbreak_farm/H5_HPAI_farm_Confirm_1423.csv", row.names = F)
library(readr)
library(readxl)
library(ggplot2)
library(dplyr)
library(stringr)
library(dendextend)
library(car) #vif()
library(formattable)
library(pROC)
complete_grid_data <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/complete_grid_data_HH_2014_to_2023.csv")
EU_grid <- complete_grid_data[complete_grid_data$Europe == 1,]
EU_grid1 <- EU_grid[,c("Id","case_YN")]
clog_EU_result_out <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/matched_pairs/result/clog_EU_result_out.csv")
MH_EU_result_out <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/matched_pairs/result/MH_EU_result_out.csv")
clog_EU_more_than_10 <- clog_EU_result_out[clog_EU_result_out$Nsp.in.Npa. > 10,]
MH_EU_more_than_10 <- MH_EU_result_out[MH_EU_result_out$Nsp.in.Npa. > 10,]
target_EU <- union(clog_EU_more_than_10$X, MH_EU_more_than_10$X)
bird_YN_europe <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/鳥種母資料/bird_YN_europe.csv")
bird_25_YN <- bird_YN_europe[,c(1,which(colnames(bird_YN_europe) %in% target_EU))]
H5_HPAI_farm <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/H5_HPAI_farm_Confirm_1423.csv")
shannon_EU_25 <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/shannon_EU_25.csv")
H5_HPAI_farm <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/H5_HPAI_farm_Confirm_1423.csv")
landcovertype_threshold_10_percent <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/landcovertype_threshold_10_percent.csv")
livestock <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/livestock.csv")
AAA <- merge(x = EU_grid1, y = bird_25_YN, by = "Id", all.x = TRUE)
BBB <- merge(x = AAA, y = shannon_EU_25, by = "Id", all.x = TRUE)
CCC <- merge(x = BBB, y = H5_HPAI_farm, by = "Id", all.x = TRUE)
View(H5_HPAI_farm)
complete_grid_data <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/LISA/complete_grid_data_HH_2014_to_2023.csv")
H5_HPAI_farm_ID <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/outbreak_farm/H5_HPAI_farm_ID.csv")
View(H5_HPAI_farm_ID)
ID_data <- complete_grid_data[,c(1,2)]
colnames(ID_data)[2] <- "H5_HPAI_farm"
ID_data[,"H5_HPAI_farm"] <- 0
View(ID_data)
ID_data[ID_data$Id %in% H5_HPAI_farm_ID$Id,"H5_HPAI_farm"] <- 1
write.csv(ID_data, file = "整理好的/H5_HPAI_farm.csv", row.names = F)
H5_HPAI_Domestic_ID <- read.csv("outbreak_farm/H5_HPAI_Domestic_ID.csv")
H5_HPAI_farm_ID <- read.csv("outbreak_farm/H5_HPAI_farm_ID.csv")
setdiff(H5_HPAI_Domestic_ID$Id, H5_HPAI_farm_ID$Id)
setdiff(H5_HPAI_farm_ID$Id, H5_HPAI_Domestic_ID$Id)
complete_grid_data <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/complete_grid_data_HH_2014_to_2023.csv")
EU_grid <- complete_grid_data[complete_grid_data$Europe == 1,]
EU_grid1 <- EU_grid[,c("Id","case_YN")]
clog_EU_result_out <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/matched_pairs/result/clog_EU_result_out.csv")
MH_EU_result_out <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/matched_pairs/result/MH_EU_result_out.csv")
clog_EU_more_than_10 <- clog_EU_result_out[clog_EU_result_out$Nsp.in.Npa. > 10,]
MH_EU_more_than_10 <- MH_EU_result_out[MH_EU_result_out$Nsp.in.Npa. > 10,]
target_EU <- union(clog_EU_more_than_10$X, MH_EU_more_than_10$X)
bird_YN_europe <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/鳥種母資料/bird_YN_europe.csv")
bird_25_YN <- bird_YN_europe[,c(1,which(colnames(bird_YN_europe) %in% target_EU))]
H5_HPAI_farm <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/H5_HPAI_farm.csv")
shannon_EU_25 <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/shannon_EU_25.csv")
H5_HPAI_farm <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/H5_HPAI_farm.csv")
landcovertype_threshold_10_percent <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/landcovertype_threshold_10_percent.csv")
livestock <- read.csv("D:/梁雋承/研究所/集大成HH_as_case_2014to2023/variable_arrange_for_second_stage/整理好的/livestock.csv")
View(H5_HPAI_farm)
AAA <- merge(x = EU_grid1, y = bird_25_YN, by = "Id", all.x = TRUE)
BBB <- merge(x = AAA, y = shannon_EU_25, by = "Id", all.x = TRUE)
CCC <- merge(x = BBB, y = H5_HPAI_farm, by = "Id", all.x = TRUE)
DDD <- merge(x = CCC, y = landcovertype_threshold_10_percent, by = "Id", all.x = TRUE)
EEE <- merge(x = DDD, y = livestock[,c(1,5,6,7)], by = "Id", all.x = TRUE)
GGG <- EEE[,-1]
# Class_95 全部都是0 剔除
HHH <- GGG[,-which(colnames(GGG) %in% "Class_95")]
View(H5_HPAI_farm)
# 參數對照表
varname <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/參數對照.csv")
View(varname)
all_variable <- colnames(HHH)[-1]
simple_result <- data.frame(matrix(0, length(all_variable), 3))
colnames(simple_result) <- c("Variable", "coefficient", "pvalue")
simple_result[,"Variable"] <- all_variable
for (i in all_variable) {
y <- "case_YN"
x <- i
simple_form <- paste(y, " ~ ", x, sep = "") %>% as.formula()
simple_log_model <- glm(simple_form, data = HHH, family = 'binomial')
simple_result[simple_result$Variable %in% i,"coefficient"] <- summary(simple_log_model)$coefficients[i,"Estimate"]
simple_result[simple_result$Variable %in% i,"pvalue"] <- summary(simple_log_model)$coefficients[i,"Pr(>|z|)"]
}
for (i in varname$original) {
simple_result[simple_result$Variable %in% i,"Variable"] <- varname[varname$original %in% i,"full_name"]
}
simple_result3 <- simple_result[21:30,]
formattable(simple_result3, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
formattable(simple_result3, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
simple_result1 <- simple_result[1:10,]
simple_result2 <- simple_result[11:20,]
simple_result3 <- simple_result[21:30,]
simple_result4 <- simple_result[31:40,]
formattable(simple_result3, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
# -------------------------------------------------------------------
# model visualise
model_visualise_OwO <- function(model){
coefficient <- summary(model)$coefficient %>% as.data.frame()
coefficient$Variable <- row.names(coefficient)
coefficient <- coefficient[,c(5,1,4)]
colnames(coefficient)[2:3] <- c("coefficient", "pvalue")
VIF_model <- vif(model) %>% as.data.frame()
colnames(VIF_model) <- "VIF"
VIF_model$Variable <- row.names(VIF_model)
OvO <- merge(x = coefficient, y = VIF_model, by = "Variable", all.x = TRUE)
for (i in varname$original) {
OvO[OvO$Variable %in% i,"Variable"] <- varname[varname$original %in% i,"full_name"]
}
formattable(OvO, align = c("l", rep("c", ncol(OvO)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
}
model_visualise_OAO <- function(model, part){
coefficient <- summary(model)$coefficient %>% as.data.frame()
coefficient$Variable <- row.names(coefficient)
coefficient <- coefficient[,c(5,1,4)]
colnames(coefficient)[2:3] <- c("coefficient", "pvalue")
VIF_model <- vif(model) %>% as.data.frame()
colnames(VIF_model) <- "VIF"
VIF_model$Variable <- row.names(VIF_model)
OvO <- merge(x = coefficient, y = VIF_model, by = "Variable", all.x = TRUE)
for (i in varname$original) {
OvO[OvO$Variable %in% i,"Variable"] <- varname[varname$original %in% i,"full_name"]
}
if (nrow(OvO) %% 2 == 0) {
OvO1 <- OvO[1:(nrow(OvO)/2),]
OvO2 <- OvO[(nrow(OvO)/2 + 1):nrow(OvO),]
}
if (nrow(OvO) %% 2 == 1) {
OvO1 <- OvO[1:((nrow(OvO)+1)/2),]
OvO2 <- OvO[((nrow(OvO)+1)/2 + 1):nrow(OvO),]
}
part <- part
if (part == "U") {
formattable(OvO1, align = c("l", rep("c", ncol(OvO)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
} else {
formattable(OvO2, align = c("l", rep("c", ncol(OvO)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
}
}
# model 外存
model_save_OwO <- function(model){
coefficient <- summary(model)$coefficient %>% as.data.frame()
coefficient$Variable <- row.names(coefficient)
coefficient <- coefficient[,c(5,1,4)]
colnames(coefficient)[2:3] <- c("coefficient", "pvalue")
VIF_model <- vif(model) %>% as.data.frame()
colnames(VIF_model) <- "VIF"
VIF_model$Variable <- row.names(VIF_model)
OvO <- merge(x = coefficient, y = VIF_model, by = "Variable", all.x = TRUE)
for (i in varname$original) {
OvO[OvO$Variable %in% i,"Variable"] <- varname[varname$original %in% i,"full_name"]
}
return(OvO)
}
# model 把不顯著者踢掉
model_final <- function(model){
coefficient <- summary(model)$coefficient %>% as.data.frame()
coefficient_sig <- coefficient[coefficient$`Pr(>|z|)` < 0.05,]
coefficient_sig1 <- coefficient_sig[-1,]
variableAA <- row.names(coefficient_sig1)
AAAA <- paste(variableAA, collapse = " + ")
formA <- paste("case_YN", AAAA, sep = " ~ ") %>% as.formula()
model_simplify <- glm(formA, data = HHH, family = 'binomial')
return(model_simplify)
}
null = glm(case_YN ~ 1, data = HHH, family = 'binomial')
full = glm(case_YN ~ ., data = HHH, family = 'binomial')
forward_log <- step(null, scope=list(lower=null, upper=full), direction="forward")
backward_log <- step(full, scope=list(lower=null, upper=full), direction="backward")
summary(forward_log)
summary(backward_log)
formattable(simple_result3, align = c("l", rep("c", ncol(simple_result1)-1)), row.names = F,
list('coefficient' = formatter("span", style = x ~ style(color = ifelse(x>0, "red", "green"))),
'pvalue' = formatter("span", style = x ~ style(color = ifelse(x < 0.05, "#EB7D00", "#000000")))))
model_visualise_OAO(model = forward_log, part = "U")
model_visualise_OAO(model = forward_log, part = "D")
model1 <- model_final(forward_log)
summary(model1)
model_visualise_OwO(model = model1)
test_prob <- predict(forward_log, newdata = HHH, type = "response") #ROC
par(pty = "s") #指定畫布繪製成正方形的大小
test_roc <- roc(HHH$case_YN ~ test_prob, plot = TRUE,
print.auc = TRUE,legacy.axes=TRUE)
plot(test_roc, print.auc = TRUE, legacy.axes=TRUE, main = "ROC curve of F/B model (EU)")
test_prob <- predict(model1, newdata = HHH, type = "response") #ROC
par(pty = "s") #指定畫布繪製成正方形的大小
test_roc <- roc(HHH$case_YN ~ test_prob, plot = TRUE,
print.auc = TRUE,legacy.axes=TRUE)
plot(test_roc, print.auc = TRUE, legacy.axes=TRUE, main = "ROC curve of Final model (EU)")
# risk map table for qgis
EEE$risk <- predict(model1, newdata = EEE, type = "response")
write.csv(EEE[,c("Id", "risk")], file = "D://梁雋承/研究所/集大成HH_as_case_2014to2023/logistic_regression/歐洲/riskmap/risk_map_qgis_farm.csv", row.names = F)
# ------------------------------------------------------
# 抓 birdlist 給 linda 做 common name
# 20240411
bird_YN_asia <- read.csv("鳥種母資料/bird_YN_asia.csv")
bird_YN_europe <- read.csv("鳥種母資料/bird_YN_europe.csv")
View(bird_YN_europe)
asia_bird_list <- colnames(bird_YN_asia)[-1]
europe_bird_list <- colnames(bird_YN_europe)[-1]
write.table(asia_bird_list, file = "鳥種母資料/asia_bird_list")
write.table(asia_bird_list, file = "鳥種母資料/asia_bird_list", row.names = F, col.names = F)
write.table(europe_bird_list, file = "鳥種母資料/europe_bird_list", row.names = F, col.names = F)
A_A_A_A_C_N8A_C_F <- read.csv("D://梁雋承/研究所/集大成refine/logistic_regression/complete_grid_data.csv")
library(readr)
library(readxl)
library(ggplot2)
library(dplyr)
HH <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/LISA/complete_grid_data_HH_2014_to_2023.csv")
View(A_A_A_A_C_N8A_C_F)
View(HH)
# 20240411
A_A_A_A_C_N8A_C_F <- read.csv("D://梁雋承/研究所/集大成refine/logistic_regression/complete_grid_data.csv")
HH1423 <- read.csv("D://梁雋承/研究所/集大成HH_as_case_2014to2023/LISA/complete_grid_data_HH_2014_to_2023.csv")
A_A_A_A_C_N8A_C_F1 <- A_A_A_A_C_N8A_C_F[,c("Id", "case_YN")]
View(A_A_A_A_C_N8A_C_F1)
colnames(A_A_A_A_C_N8A_C_F1)[2] <- "A_A_A_A_C_N8A_C_F"
colnames(HH1423_1)[2] <- "HH1423"
HH1423_1 <- HH1423[,c("Id", "case_YN")]
colnames(HH1423_1)[2] <- "HH1423"
View(HH1423_1)
